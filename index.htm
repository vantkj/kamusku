<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kamus Mandarin Taiwan - Indonesia</title>
<style>
body {background:#121212;color:#f1f1f1;font-family:"Noto Sans TC","Segoe UI",sans-serif;margin:0;padding:20px;}
h1 {text-align:center;color:#00bcd4;margin-bottom:20px;}
input {width:100%;padding:10px;border-radius:6px;border:none;margin-bottom:20px;font-size:16px;background:#1f1f1f;color:#f1f1f1;}
.entry {background:#1e1e1e;padding:15px;border-radius:8px;margin-bottom:15px;box-shadow:0 2px 5px rgba(0,0,0,0.5);}
.hanzi {font-size:26px;color:#ffd54f;}
.pinyin {font-size:16px;color:#b0bec5;}
.arti {font-size:17px;color:#fff;margin-top:5px;}
.penjelasan,.contoh {font-size:15px;color:#ccc;margin-top:4px;}
@media(max-width:600px){body{padding:10px}.hanzi{font-size:22px}.pinyin{font-size:14px}}
</style>
</head>
<body>
<h1>üìò Kamus Mandarin Taiwan - Indonesia</h1>
<input type="text" id="search" placeholder="Cari Hanzi, Pinyin (tanpa nada), atau Arti...">
<div id="kamusList"></div>

<script>
let kamus = [];
let filtered = [];
let renderedCount = 0;
const BATCH_SIZE = 20;

const toneMap = {'ƒÅ':'a','√°':'a','«é':'a','√†':'a','ƒì':'e','√©':'e','ƒõ':'e','√®':'e','ƒ´':'i','√≠':'i','«ê':'i','√¨':'i','≈ç':'o','√≥':'o','«í':'o','√≤':'o','≈´':'u','√∫':'u','«î':'u','√π':'u','«ñ':'v','«ò':'v','«ö':'v','«ú':'v'};
function stripTones(pinyin){return pinyin.replace(/[ƒÅ√°«é√†ƒì√©ƒõ√®ƒ´√≠«ê√¨≈ç√≥«í√≤≈´√∫«î√π«ñ«ò«ö«ú]/g,m=>toneMap[m]).replace(/\s+/g,'');}

function renderBatch(){
  const container = document.getElementById("kamusList");
  const batch = filtered.slice(renderedCount, renderedCount + BATCH_SIZE);
  batch.forEach(item=>{
    const div=document.createElement("div");
    div.className="entry";
    div.innerHTML=`
      <div class="hanzi">${item.hanzi}</div>
      <div class="pinyin">${item.pinyin}</div>
      <div class="arti">${item.arti}</div>
      <div class="penjelasan">üìù ${item.penjelasan}</div>
      <div class="contoh">üìò ${item.contoh}</div>
    `;
    container.appendChild(div);
  });
  renderedCount += batch.length;
}

// Load JSON
fetch('kamus.json')
.then(res=>res.json())
.then(data=>{
  kamus = data;
  kamus.sort((a,b)=>stripTones(a.pinyin.toLowerCase()).localeCompare(stripTones(b.pinyin.toLowerCase())));
  filtered = [...kamus];
  renderedCount = 0;
  document.getElementById("kamusList").innerHTML="";
  renderBatch();
});

// Search
document.getElementById("search").addEventListener("input",function(){
  const val=this.value.toLowerCase().replace(/\s+/g,'');
  filtered = kamus.filter(item=>{
    const pinyinNoTone = stripTones(item.pinyin.toLowerCase());
    return item.hanzi.includes(val) || pinyinNoTone.includes(val) || item.arti.toLowerCase().includes(val);
  });
  renderedCount = 0;
  document.getElementById("kamusList").innerHTML="";
  renderBatch();
});

// Infinite scroll
window.addEventListener("scroll",()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 50){
    renderBatch();
  }
});
</script>
</body>
</html>
